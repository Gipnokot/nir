<%= form_with model: @publication, local: true, class: 'needs-validation', novalidate: true do |form| %>
  <div class="mb-3">
    <%= form.label :title, "Название", class: 'form-label' %>
    <%= form.text_field :title, class: 'form-control', required: true %>
    <div class="invalid-feedback">Пожалуйста, введите название.</div>
  </div>

  <div class="mb-3">
    <%= form.label :dtr, "Дата", class: 'form-label' %>
    <%= form.text_field :dtr, class: 'form-control', required: true %>
    <div class="invalid-feedback">Пожалуйста, введите дату.</div>
  </div>

  <div class="mb-3">
    <%= form.label :doi, "DOI", class: 'form-label' %>
    <%= form.text_field :doi, class: 'form-control' %>
    <div class="invalid-feedback">Пожалуйста, введите DOI.</div>
  </div>

  <div class="mb-3">
    <%= form.label :href, "Ссылка", class: 'form-label' %>
    <%= form.text_field :href, class: 'form-control' %>
    <div class="invalid-feedback">Пожалуйста, введите ссылку.</div>
  </div>

  <div class="mb-3">
    <%= form.label :output, "Выходные данные", class: 'form-label' %>
    <%= form.text_field :output, class: 'form-control' %>
    <div class="invalid-feedback">Пожалуйста, введите выходные данные.</div>
  </div>

  <% @publication.authors.each_with_index do |author, index| %>
    <%= fields_for "publication[authors_attributes][#{index}]", author do |author_form| %>
      <div class="mb-3">
        <%= author_form.label :lastname, "Фамилия", class: 'form-label' %>
        <%= author_form.text_field :lastname, class: 'form-control', required: true %>
        <div class="invalid-feedback">Пожалуйста, введите фамилию.</div>
      </div>

      <div class="mb-3">
        <%= author_form.label :name, "Имя", class: 'form-label' %>
        <%= author_form.text_field :name, class: 'form-control', required: true %>
        <div class="invalid-feedback">Пожалуйста, введите имя.</div>
      </div>

      <div class="mb-3">
        <%= author_form.label :fathername, "Отчество", class: 'form-label' %>
        <%= author_form.text_field :fathername, class: 'form-control', required: true %>
        <div class="invalid-feedback">Пожалуйста, введите отчество.</div>
      </div>
    <% end %>
  <% end %>

  <div class="actions">
    <%= form.submit 'Сохранить изменения', class: 'btn btn-primary' %>
    <%= link_to 'Назад', cathedra_path, class: 'btn btn-secondary' %>
  </div>
<% end %>

<script>
  // Пример валидации Bootstrap
  (function() {
    'use strict'
    window.addEventListener('load', function() {
      var forms = document.getElementsByClassName('needs-validation')
      Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
          if (form.checkValidity() === false) {
            event.preventDefault()
            event.stopPropagation()
          }
          form.classList.add('was-validated')
        }, false)
      })
    }, false)
  })()
</script>
