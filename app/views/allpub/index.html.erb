<%= form_with url: allpub_path, method: :get, local: true do |form| %>
  <div class="form-group mr-2">
    <%= form.label :cathedra_id, "Выберите кафедру:" %>
    <%= form.select :cathedra_id, options_from_collection_for_select(@cathedras, :id, :name_cathedra, params[:cathedra_id]), include_blank: "Выберите кафедру", class: "form-control" %>
  </div>
  <div class="form-group mr-2">
    <%= form.label :teacher_id, "Выберите преподавателя:" %>
    <%= form.select :teacher_id, options_from_collection_for_select(@teachers, :author_id, :full_name, params[:teacher_id]), include_blank: "Выберите преподавателя", class: "form-control" %>
  </div>
  <%= form.submit "Показать", class: "btn btn-primary" %>
<% end %>

<div class="table-responsive">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th colspan="3">ФИО студента</th>
        <th>Название публикации</th>
        <th>Дата публикации</th>
        <th>DOI</th>
        <th>Ссылка</th>
        <th>Результат</th>
      </tr>
    </thead>
    <tbody>
      <% if @student_publications.present? %>
        <% @student_publications.each do |student| %>
          <tr>
            <td colspan="3"><%= "#{student['student_lastname']}<br> #{student['student_name']}<br> #{student['student_fathername']}".html_safe %></td>
            <td><%= student['publication_title'] %></td>
            <td><%= student['publication_date'] %></td>
            <td><%= student['publication_doi'] %></td>
            <td><a href="<%= student['publication_href'] %>" class="wrap-link"><%= student['publication_href'] %></a></td>
            <td><%= student['publication_output'] %></td>
          </tr>
        <% end %>
      <% else %>
        <tr>
          <td colspan="8">Нет данных для отображения</td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
<%= link_to 'Скачать CSV', allpub_path(format: 'csv', cathedra_id: params[:cathedra_id]), class: 'btn btn-primary' %>
